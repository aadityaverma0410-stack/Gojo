<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gojo Archive | Community</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <style>
        /* ADD YOUR CSS HERE OR LINK TO YOUR CSS FILE */
        body { background: #000; color: white; font-family: sans-serif; text-align: center; }
        .mission-archive-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; padding: 20px; }
        .memory-card img { width: 100%; border-radius: 8px; filter: blur(10px); transition: 0.5s; cursor: pointer; }
        .memory-card img.reveal { filter: blur(0px); }
        .upload-section { margin: 20px; padding: 20px; border: 1px solid #333; }
    </style>
</head>
<body>

    <h1>üßø GOJO ARCHIVE</h1>

    <div class="upload-section">
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="handleUpload()">Upload Memory</button>
        <p id="uploadStatus"></p>
    </div>

    <div class="mission-archive-grid" id="gallery">
        </div>

    <script>
        // --- 4. FIREBASE CONFIGURATION ---
        // REPLACE THESE with your actual keys from Firebase Console
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "gojo-archive.firebaseapp.com",
            projectId: "gojo-archive",
            storageBucket: "gojo-archive.appspot.com",
            messagingSenderId: "YOUR_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // --- 5. THE BADGE MACHINE (Authentication) ---
        auth.onAuthStateChanged((user) => {
            if (!user) {
                auth.signInAnonymously()
                    .then(() => console.log("Authenticated: Secret Badge Assigned üßø"))
                    .catch((err) => console.error("Auth Error:", err));
            } else {
                console.log("Welcome back, Sorcerer:", user.uid);
            }
        });

        // --- 6. REAL-TIME GALLERY (The Six Eyes) ---
        // This listens for new images and updates the page instantly
        db.collection("memories").orderBy("time", "desc")
            .onSnapshot((snapshot) => {
                const gallery = document.getElementById("gallery");
                gallery.innerHTML = ""; // Clear old list

                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const card = `
                        <div class="memory-card">
                            <img src="${data.url}" onclick="this.classList.toggle('reveal')" title="Click to reveal">
                            <p>${new Date(data.time).toLocaleDateString()}</p>
                        </div>
                    `;
                    gallery.innerHTML += card;
                });
            });

        // --- 7. UPLOAD LOGIC ---
        async function handleUpload() {
            const file = document.getElementById("imageInput").files[0];
            const status = document.getElementById("uploadStatus");

            if (!file) return alert("Select a file first!");
            
            status.innerText = "Expanding Domain... (Uploading)";

            const timestamp = Date.now();
            const storageRef = storage.ref(`memories/${timestamp}_${file.name}`);

            try {
                // Upload to Storage
                const snapshot = await storageRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();

                // Save info to Firestore
                await db.collection("memories").add({
                    url: downloadURL,
                    time: timestamp,
                    userId: auth.currentUser.uid
                });

                status.innerText = "Memory Archived Successfully! ‚úÖ";
                document.getElementById("imageInput").value = ""; // Clear input
            } catch (error) {
                console.error(error);
                status.innerText = "Upload failed. Check console. ‚ùå";
            }
        }
    </script>
</body>
</html>
